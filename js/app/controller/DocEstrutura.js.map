{"version":3,"sources":["../../app-es6/controller/DocEstrutura.js"],"names":["currentInstance","DocEstrutura","_mapaListagemTotalElementos","Map","jsonEstrutura","readOnlyFields","_objEstrutura","JSON","parse","_readOnlyFields","$","empty","_renderAgregador","idContainer","agregador","dadosItmIndexado","write","agregadorView","build","wr","html","_renderItens","idContainerItens","itens","listagem","totalItens","_getTotalItensListagem","id","builder","listagemView","idBotaoNovo","on","evt","adicionaItemLista","idItemCorrente","idxEl","_montaDadosItmIndexado","idWrapCorrente","botaoDeleteView","buildBotaoDelete","idBotaoDelete","removerItens","indice","idListagem","posicaoIndice","indiceNovoElemento","_getProximoSequencial","findListagem","buildContainerItem","get","set","remove","reorganizaIndiceIdsListagem","each","children","i","item","find","i2","input","arr","attr","split","join","listaItens","console","log","forEach","tipo","AGREGADOR","LISTAGEM","_renderListagem","htmlRender","TEXTO","texto","LISTA","lista","NUMERO","numero","MOEDA","moeda","DATA","data","error","docEstruturaController"],"mappings":"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","file":"DocEstrutura.js","sourcesContent":["import {AgregadorBuilder} from '../builder/grupo/AgregadorBuilder';\r\nimport {ListagemBuilder}  from '../builder/grupo/ListagemBuilder';\r\n\r\nimport {WriterService} from '../service/WriterService';\r\nimport {RenderService} from '../service/RenderService';\r\n\r\nimport {Elemento} from '../constantes/Elemento';\r\n\r\nimport {JsonUtil} from '../util/JsonUtil';\r\n\r\nclass DocEstrutura{\r\n    \r\n    constructor(){\r\n        this._mapaListagemTotalElementos = new Map();        \r\n    }\r\n    \r\n    \r\n    iniciaConstrucao(jsonEstrutura, readOnlyFields){\r\n        this._objEstrutura = JSON.parse(jsonEstrutura);\r\n        this._readOnlyFields = readOnlyFields;\r\n        \r\n        $(\"#container-form\").empty();\r\n        this._renderAgregador('container-form', this._objEstrutura);\r\n        \r\n    }    \r\n        \r\n\r\n    _renderAgregador(idContainer, agregador, dadosItmIndexado){\r\n        let write = new WriterService(idContainer);\r\n        let agregadorView = new AgregadorBuilder(agregador).build(dadosItmIndexado);\r\n        \r\n        write.wr(agregadorView.html);        \r\n        this._renderItens(agregadorView.idContainerItens, agregador.itens, dadosItmIndexado);\r\n    }\r\n    \r\n    \r\n    _renderListagem(idContainer, listagem, dadosItmIndexado){\r\n        let write = new WriterService(idContainer);\r\n        var totalItens = this._getTotalItensListagem(listagem.id);\r\n        let builder = new ListagemBuilder(listagem);      \r\n        \r\n        \r\n        \r\n        let listagemView = builder.build(this._readOnlyFields, totalItens, dadosItmIndexado);\r\n        write.wr(listagemView.html, ()=>{\r\n            $(`#${listagemView.idBotaoNovo}`).on('click', (evt)=> {\r\n                this.adicionaItemLista(listagem.id);\r\n            });\r\n        });\r\n        \r\n        \r\n        for (var idxEl=0; idxEl<totalItens; idxEl++){\r\n            let idItemCorrente = `wrap-componentes-${listagem.id}-${idxEl}`\r\n\t\t\tthis._renderItens(idItemCorrente, listagem.itens, this._montaDadosItmIndexado(listagem.id,idxEl));\r\n            \r\n            let idWrapCorrente = `wrap-item-${listagem.id}-${idxEl}`\r\n            let botaoDeleteView = builder.buildBotaoDelete(idxEl);\r\n            \r\n            new WriterService(idWrapCorrente).wr(botaoDeleteView.html, ()=>{\r\n                $(`#${botaoDeleteView.idBotaoDelete}`).on('click', (evt)=> this.removerItens(listagem.id, botaoDeleteView.indice));\r\n            });            \r\n\t\t}        \r\n    }\r\n    \r\n    \r\n    _montaDadosItmIndexado(idListagem, idxEl){\r\n        return {idListagem:idListagem, posicaoIndice:idxEl}\r\n    } \r\n    \r\n    \r\n    adicionaItemLista(idListagem){\r\n        let indiceNovoElemento = this._getProximoSequencial(idListagem);\r\n\t\tlet listagem = JsonUtil.findListagem(this._objEstrutura, idListagem);\r\n\t\tlet builder = new ListagemBuilder(listagem);\r\n        \r\n\t\tnew WriterService(`container-${idListagem}`)\r\n            .wr(builder.buildContainerItem(indiceNovoElemento));\r\n        \r\n        let idItemCorrente = `wrap-componentes-${idListagem}-${indiceNovoElemento}`;\r\n        this._renderItens(idItemCorrente, listagem.itens, this._montaDadosItmIndexado(listagem.id, indiceNovoElemento));        \r\n        \r\n        let idWrapCorrente = `wrap-item-${listagem.id}-${indiceNovoElemento}`;        \r\n        let botaoDeleteView = builder.buildBotaoDelete(indiceNovoElemento);\r\n        \r\n        new WriterService(idWrapCorrente).wr(botaoDeleteView.html, ()=>{\r\n            $(`#${botaoDeleteView.idBotaoDelete}`).on('click', (evt)=> this.removerItens(listagem.id, botaoDeleteView.indice));\r\n        });\r\n\t};\r\n        \r\n    removerItens(idListagem, indice){\r\n        var idContainer = \"wrap-item-\"+idListagem+\"-\"+indice;\r\n\t\tvar totalItens = this._mapaListagemTotalElementos.get(idListagem);\r\n\t\tthis._mapaListagemTotalElementos.set(idListagem, totalItens-1)\r\n        \r\n\t\t$(\"#\"+idContainer).remove();\r\n\t\tthis.reorganizaIndiceIdsListagem(idListagem);\r\n    }\r\n    \r\n    reorganizaIndiceIdsListagem(idListagem){\r\n\t\t$.each($(\"#container-\"+idListagem).children(), function(i, item){\r\n\t\t\t$.each($(item).find(\".form-control\"), function(i2, input){\r\n\t\t\t\tvar arr = $(input).attr('id').split(\"-\");\r\n\t\t\t\tarr[1] = i;\r\n\t\t\t\t$(input).attr('id', arr.join('-'));\r\n\t\t\t} )\r\n\t\t})\t\t\t\t\r\n\t}\r\n\r\n    _renderItens(idContainer, listaItens, dadosItmIndexado){\r\n        \r\n        console.log(idContainer);\r\n        \r\n        listaItens.forEach(item => {            \r\n            if ( item.tipo == Elemento.tipo.AGREGADOR ){\r\n                this._renderAgregador(idContainer, item, dadosItmIndexado);\r\n            \r\n            } else  if ( item.tipo == Elemento.tipo.LISTAGEM ){\r\n                this._renderListagem(idContainer, item, dadosItmIndexado);\r\n\r\n            } else {\r\n                let htmlRender = new RenderService(item, this._readOnlyFields, dadosItmIndexado, new WriterService(idContainer));\r\n                 \r\n                switch (item.tipo) {\r\n                case Elemento.tipo.TEXTO:\r\n                    htmlRender.texto();\r\n                    break;\r\n                        \r\n                case Elemento.tipo.LISTA:\r\n                    htmlRender.lista();\r\n                    break;\r\n                    \r\n                case Elemento.tipo.NUMERO:\r\n                    htmlRender.numero();\r\n                    break;\r\n                        \r\n                case Elemento.tipo.MOEDA:\r\n                    htmlRender.moeda(); \r\n                    break;\r\n                        \r\n                case Elemento.tipo.DATA:\r\n                    htmlRender.data();\r\n                    break;\r\n                        \r\n                default:\r\n                    console.error(\"Desculpe, estamos sem nenhuma \" + item.tipo + \".\");\r\n                }\r\n                \r\n            }\r\n\r\n        });\r\n    }\r\n    \r\n    \r\n    _getTotalItensListagem(idListagem){\r\n        if ( this._mapaListagemTotalElementos.get(idListagem) == null ){\r\n\t\t\tthis._mapaListagemTotalElementos.set(idListagem, 1);\r\n\t\t} \t\t\r\n\t\treturn this._mapaListagemTotalElementos.get(idListagem);\r\n    }\r\n    \r\n    _getProximoSequencial(idListagem){\r\n        var indiceNovoElemento = this._mapaListagemTotalElementos.get(idListagem);\r\n\t\tthis._mapaListagemTotalElementos.set(idListagem, indiceNovoElemento+1);\r\n        return indiceNovoElemento;\r\n    }\r\n    \r\n    \r\n\r\n}\r\n\r\nlet docEstruturaController = new DocEstrutura();\r\n\r\nexport function currentInstance(){\r\n    return docEstruturaController;\r\n}"]}