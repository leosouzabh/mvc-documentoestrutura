{"version":3,"sources":["../../app-es6/service/GeraJsonService.js"],"names":["GeraJsonService","_mapaListagemTotalElementos","Map","_jsonFinal","_paths","_stackPath","nomeGrupo","$","data","filhos","children","_processaItens","console","log","JSON","stringify","each","i","item","hasClass","campo","_processaListagem","_addObject","_processaItem","objAgregador","_processaAgregador","attr","novoObj","jsonDetalhe","extendido","extend","id","nomeObj","out","push","listagem","pop","labelGrupo","itens","arrWrapItens","wrapItem","registro","i2","itemParseado","find","label","desc","value","dataIso","_addPath","jQuery","parseJSON","path","join"],"mappings":"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","file":"GeraJsonService.js","sourcesContent":["export class GeraJsonService {\r\n    \r\n    constructor(){\r\n        this._mapaListagemTotalElementos = new Map();\r\n        this._jsonFinal = {\r\n            \"nomeGrupo\": \"\",\r\n            \"detalhe\": {}\r\n        };\r\n        this._paths = [];\r\n        this._stackPath = [\"$\", \"detalhe\"];\r\n    }\r\n\r\n    geraJson(){        \r\n        this._jsonFinal.nomeGrupo = $(\"#0-root\").data('label');\r\n\r\n        var filhos = $(\"#container-0-root\").children();\r\n        \r\n        this._processaItens(filhos);\r\n        console.log(  JSON.stringify(this._jsonFinal)  );\r\n        console.log(  JSON.stringify(this._paths)  );\r\n    }\r\n    \r\n    _processaItens(filhos){\r\n        console.log(filhos);\r\n        $.each( filhos, (i, item)=>{\r\n            if ( $(item).hasClass(\"listagem\") ){\r\n                var campo = this._processaListagem(item);\r\n                this._addObject(campo);\r\n\r\n            } else if ( $(item).hasClass(\"campo\") ){\r\n                var campo = this._processaItem(item);\r\n                this._addObject(campo);\r\n\r\n            } else {\r\n                var objAgregador = this._processaAgregador($(item).attr('id'));\r\n                this._addObject(objAgregador);\r\n            }\t\t\t\r\n        });\r\n        \r\n    }\r\n    \r\n    \r\n    _addObject(novoObj){\r\n        let jsonDetalhe = this._jsonFinal['detalhe'];\r\n        let extendido = $.extend({}, jsonDetalhe, novoObj);\r\n        this._jsonFinal['detalhe'] = extendido;\r\n    }\r\n\r\n    \r\n    _processaAgregador(id){\r\n        let nomeObj = $(`#${id}`).data('label');\r\n        let out = {};\r\n        out[nomeObj] = {};\r\n        this._stackPath.push(`'${nomeObj}'`);\t\r\n        \r\n        $.each( $(`#container-${id}`).children(), (i, item)=>{\r\n            if ( $(item).hasClass(\"listagem\") ){\r\n                let listagem = this._processaListagem(item);\r\n                $.extend(out[nomeObj], out[nomeObj], listagem);\t\t\t\r\n\r\n            } else if ( $(item).hasClass(\"campo\") ){\r\n                let campo = this._processaItem(item);\r\n                $.extend(out[nomeObj], out[nomeObj], campo);\r\n\r\n            } else {\r\n                var objAgregador = this._processaAgregador($(item).attr('id'));\r\n                $.extend(out[nomeObj], out[nomeObj], objAgregador);\r\n            }\r\n        });\r\n        this._stackPath.pop();\r\n        return out;\r\n    }\r\n\r\n\r\n    _processaListagem(listagem){\r\n        let labelGrupo = $(listagem).data('label');\r\n        let out = {}\r\n        out[labelGrupo] = {};\r\n        out[labelGrupo].itens = []\r\n\r\n        this._stackPath.push(`'${labelGrupo}'`);\t\r\n        \r\n        \r\n        let arrWrapItens = $(`#container-${$(listagem).attr('id')}`).children();\r\n        $.each(arrWrapItens, (i, wrapItem)=>{\r\n            \r\n            let registro = {};\r\n            this._stackPath.push(`itens[${i}]`);            \r\n            $.each($(wrapItem).children(), (i2, item)=>{\r\n                if (i2 > 0){\r\n                    let itemParseado = this._processaItem(item);\r\n                    if (itemParseado){\r\n                        $.extend(registro, itemParseado, itemParseado);\r\n                    }\r\n                }                       \r\n            });            \r\n            out[labelGrupo].itens.push(registro);\r\n            this._stackPath.pop();\r\n        });\r\n\r\n        this._stackPath.pop();\r\n        return out;\r\n    }\r\n    \r\n\r\n    _processaItem(item){\r\n        \r\n        if ( $(item).hasClass(\"listagem\") ){\r\n            return this._processaListagem(item);\r\n\r\n        } else if ( $(item).hasClass(\"campo\") ){\r\n            let campo = $(item).find(\".form-control\")[0];\r\n            if (campo){\r\n                let label = $(item).data('label');\r\n                let desc = campo.value;\r\n\r\n                if ( $(campo).hasClass('campo-data') ){\r\n                    if (campo.value != \"\"){\r\n                        var dataIso = 'DATA';//moment(campo.value, \"DD/MM/YYYY\").toISOString();\r\n                        desc = \"ISODate(\"+dataIso+\")\";\r\n                    }\r\n                }\r\n                this._addPath(label);\r\n                return jQuery.parseJSON(`{\"${label}\":\"${desc}\"}`);\r\n            }\r\n\r\n        } else {\r\n            return this._processaAgregador($(item).attr('id'));\r\n        }\t\t\t\r\n        \r\n        \r\n    }\r\n    \r\n\r\n    _addPath(id){\r\n        this._paths.push({\r\n            campo:id,\r\n            path: `${this._stackPath.join('.')}.'${id}'`\r\n        });\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}